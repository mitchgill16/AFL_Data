library('fitzRoy')
library('dplyr')
args = commandArgs(trailingOnly=TRUE)
getwd()
test_y <- 2022
test_r <- 27
results <- fetch_results(test_y, test_r)
library('fitzRoy')
library('dplyr')
library('sys')
#make Pavs for given year
#today <- Sys.Date()
afltables<-fetch_player_stats_afltables(2022)
afltables_home<-filter(afltables, Playing.for==Home.team)
afltables_away<-filter(afltables,Playing.for==Away.team)
afltables_home$pavO<-afltables_home$Home.score +
0.25*afltables_home$Hit.Outs +
3*afltables_home$Goal.Assists+
afltables_home$Inside.50s+
afltables_home$Marks.Inside.50+
(afltables_home$Frees.For-afltables_home$Frees.Against)
afltables_home$pavD<-20*afltables_home$Rebounds +
12*afltables_home$One.Percenters+
(afltables_home$Marks-4*afltables_home$Marks.Inside.50+2*(afltables_home$Frees.For-afltables_home$Frees.Against))-
2/3*afltables_home$Hit.Outs
afltables_home$pavM<-15*afltables_home$Inside.50s+
20*afltables_home$Clearances +
3*afltables_home$Tackles+
1.5*afltables_home$Hit.Outs +
(afltables_home$Frees.For-afltables_home$Frees.Against)
afltables_away$pavO<-afltables_away$Away.score +
0.25*afltables_away$Hit.Outs +
3*afltables_away$Goal.Assists+
afltables_away$Inside.50s+
afltables_away$Marks.Inside.50+
(afltables_away$Frees.For-afltables_away$Frees.Against)
afltables_away$pavD<-20*afltables_away$Rebounds +
12*afltables_away$One.Percenters+
(afltables_away$Marks-4*afltables_away$Marks.Inside.50+2*(afltables_away$Frees.For-afltables_away$Frees.Against))-
2/3*afltables_away$Hit.Outs
afltables_away$pavM<-15*afltables_away$Inside.50s+
20*afltables_away$Clearances +
3*afltables_away$Tackles+
1.5*afltables_away$Hit.Outs +
(afltables_away$Frees.For-afltables_away$Frees.Against)
fulltable<-rbind(afltables_home,afltables_away)
names(fulltable)
View(fulltable)
View(fulltable)
#check a player
player_check <- fulltable%>%group_by(First.name, Surname)%>% summarise(total_mid_pav=sum(pavO))%>%
filter(Surname=="Dangerfield", First.name=="Patrick")
View(player_check)
#check a player
player_check <- fulltable%>%group_by(First.name, Surname)%>% summarise(total_O_pav=sum(pavO))%>%
filter(Surname=="Dangerfield", First.name=="Patrick")
team_check <- fulltable%>%group_by(Playing.for)%>% summarise(team_O_pav=sum(pavO))
View(team_check)
#check a player
player_check <- fulltable%>%group_by(Playing.for, First.name, Surname)%>% summarise(total_O_pav=sum(pavO))%>%
filter(Surname=="Dangerfield", First.name=="Patrick")
team_check <- fulltable%>%group_by(Playing.for)%>% summarise(team_O_pav=sum(pavO))
1990/59831.75
100* 0.03325993
#check a player
player_check <- fulltable%>%group_by(Playing.for, First.name, Surname)%>% summarise(total_O_pav=sum(pavO),
games_played=count(Playing.for))%>%
filter(Surname=="Dangerfield", First.name=="Patrick")
#check a player
players <- fulltable%>%group_by(Playing.for, First.name, Surname)%>%
summarise(total_O_pav=sum(pavO), total_D_pav=sum(pavD), total_M_pav=sum(pavM), games_played=n())%>%
filter(Surname=="Dangerfield", First.name=="Patrick")
View(players)
teams <- fulltable%>%group_by(Playing.for)%>%
summarise(team_O_pav=sum(pavO), team_D_pav=sum(pavD), team_M_pav=sum(pavM), team_played=n())
View(teams)
View(fulltable)
View(fulltable)
team_played <- fulltable%>%group_by(Playing.for, Round) %>% summarise(team_played = n())
View(team_played)
team_played <- fulltable%>%group_by(Playing.for, Round) %>% summarise(team_played = n()) %>%
select(Playing.for, team_played) %>% distinct()
View(team_played)
View(fulltable)
team_played <- fulltable%>%group_by(Playing.for, Round)# %>% summarise(team_played = n()) %>%
View(team_played)
team_played <- fulltable%>%group_by(Playing.for, Round) %>% summarise(team_played = n()) #%>%
View(team_played)
team_played <- fulltable%>%group_by(Playing.for, Round) %>%
select(Playing.for, team_played) %>% distinct()
team_played <- fulltable%>%group_by(Playing.for, Round) %>% select(Playing.for, Round) %>% distinct()
View(team_played)
team_played <- fulltable%>%group_by(Playing.for, Round) %>% select(Playing.for, Round) %>% distinct() %>%
summarise(count = n())
View(team_played)
team_played <- fulltable%>%group_by(Playing.for, Round) %>% select(Playing.for, Round) %>% distinct() %>%
group_by(Playing.for) %>% summarise(count = n())
View(team_played)
teams <- merge(teams, teams_played)
teams <- merge(teams, team_played)
View(teams)
team_played <- fulltable%>%group_by(Playing.for, Round) %>% select(Playing.for, Round) %>% distinct() %>%
group_by(Playing.for) %>% summarise(team_played_games = n())
teams <- merge(teams, team_played)
teams <- fulltable%>%group_by(Playing.for)%>%
summarise(team_O_pav=sum(pavO), team_D_pav=sum(pavD), team_M_pav=sum(pavM))
team_played <- fulltable%>%group_by(Playing.for, Round) %>% select(Playing.for, Round) %>% distinct() %>%
group_by(Playing.for) %>% summarise(team_played_games = n())
teams <- merge(teams, team_played)
View(teams)
View(fulltable)
players <- fulltable%>%group_by(Playing.for, First.name, Surname, ID)%>%
summarise(total_O_pav=sum(pavO), total_D_pav=sum(pavD), total_M_pav=sum(pavM), games_played=n())
players$total_pav <- players$total_O_pav + players$total_D_pav + players$total_M_pav
teams <- fulltable%>%group_by(Playing.for)%>%
summarise(team_O_pav=sum(pavO), team_D_pav=sum(pavD), team_M_pav=sum(pavM))
team_played <- fulltable%>%group_by(Playing.for, Round) %>% select(Playing.for, Round) %>% distinct() %>%
group_by(Playing.for) %>% summarise(team_played_games = n())
teams <- merge(teams, team_played)
combined_df <- left_join(players, teams, by = 'Playing.for')
View(combined_df)
teams <- fulltable%>%group_by(Playing.for)%>%
summarise(team_O_pav=sum(pavO), team_D_pav=sum(pavD), team_M_pav=sum(pavM))
teams$team_total_pav <- teams$team_O_pav + teams$team_M_pav + teams$team_D_pav
team_played <- fulltable%>%group_by(Playing.for, Round) %>% select(Playing.for, Round) %>% distinct() %>%
group_by(Playing.for) %>% summarise(team_played_games = n())
players <- fulltable%>%group_by(Playing.for, First.name, Surname, ID)%>%
summarise(total_O_pav=sum(pavO), total_D_pav=sum(pavD), total_M_pav=sum(pavM), games_played=n())
players$total_pav <- players$total_O_pav + players$total_D_pav + players$total_M_pav
teams <- fulltable%>%group_by(Playing.for)%>%
summarise(team_O_pav=sum(pavO), team_D_pav=sum(pavD), team_M_pav=sum(pavM))
teams$team_total_pav <- teams$team_O_pav + teams$team_M_pav + teams$team_D_pav
team_played <- fulltable%>%group_by(Playing.for, Round) %>% select(Playing.for, Round) %>% distinct() %>%
group_by(Playing.for) %>% summarise(team_played_games = n())
teams <- merge(teams, team_played)
combined_df <- left_join(players, teams, by = 'Playing.for')
combined_df$calculated_PAV <- (combined_df$total_pav / combined_df$team_total_pav) * 100 *
(combined_df$team_played_games / combined_df$games_played)
View(combined_df)
combined_df$calculated_O_PAV <- (combined_df$total_O_pav / combined_df$team_O_pav) * 100 *
(combined_df$team_played_games / combined_df$games_played)
combined_df$calculated_M_PAV <- (combined_df$total_M_pav / combined_df$team_M_pav) * 100 *
(combined_df$team_played_games / combined_df$games_played)
combined_df$calculated_D_PAV <- (combined_df$total_D_pav / combined_df$team_D_pav) * 100 *
(combined_df$team_played_games / combined_df$games_played)
combined_df$calculated_total_PAV <- combined_df$calculated_D_PAV + combined_df$calculated_O_PAV +
combined_df$calculated_M_PAV
View(combined_df)
players <- fulltable%>%group_by(Playing.for, First.name, Surname, ID)%>%
summarise(total_O_pav=sum(pavO), total_D_pav=sum(pavD), total_M_pav=sum(pavM), games_played=n())
teams <- fulltable%>%group_by(Playing.for)%>%
summarise(team_O_pav=sum(pavO), team_D_pav=sum(pavD), team_M_pav=sum(pavM))
team_played <- fulltable%>%group_by(Playing.for, Round) %>% select(Playing.for, Round) %>% distinct() %>%
group_by(Playing.for) %>% summarise(team_played_games = n())
teams <- merge(teams, team_played)
combined_df <- left_join(players, teams, by = 'Playing.for')
combined_df$calculated_O_PAV <- (combined_df$total_O_pav / combined_df$team_O_pav) * 100 *
(combined_df$team_played_games / combined_df$games_played)
combined_df$calculated_M_PAV <- (combined_df$total_M_pav / combined_df$team_M_pav) * 100 *
(combined_df$team_played_games / combined_df$games_played)
combined_df$calculated_D_PAV <- (combined_df$total_D_pav / combined_df$team_D_pav) * 100 *
(combined_df$team_played_games / combined_df$games_played)
combined_df$calculated_total_PAV <- combined_df$calculated_D_PAV + combined_df$calculated_O_PAV +
combined_df$calculated_M_PAV
combined_df <- combined_df %>% select(Playing.for, First.name, Surname, calculated_total_PAV,
calculated_O_PAV, calculated_M_PAV, calculated_D_PAV)
View(combined_df)
teams <- fulltable%>%group_by(Playing.for)%>%
summarise(team_O_pav=sum(pavO), team_D_pav=sum(pavD), team_M_pav=sum(pavM))
sum_O <- sum(teams$team_O_pav)
sum_M <- sum(teams$team_M_pav)
sum_D <- sum(teams$team_D_pav)
teams$prop_pav_O <- (teams$team_O_pav / sum_O) * 1800
View(teams)
sum(teams$prop_pav_O)
teams$prop_pav_M <- (teams$team_M_pav / sum_M) * 1800
teams$prop_pav_D <- (teams$team_D_pav / sum_D) * 1800
View(teams)
team_played <- fulltable%>%group_by(Playing.for, Round) %>% select(Playing.for, Round) %>% distinct() %>%
group_by(Playing.for) %>% summarise(team_played_games = n())
teams <- merge(teams, team_played)
combined_df <- left_join(players, teams, by = 'Playing.for')
View(combined_df)
combined_df$calculated_O_PAV <- (combined_df$total_O_pav / combined_df$team_O_pav) * combined_df$prop_pav_O
combined_df$calculated_M_PAV <- (combined_df$total_M_pav / combined_df$team_M_pav) * combined_df$prop_pav_M
combined_df$calculated_D_PAV <- (combined_df$total_D_pav / combined_df$team_D_pav) * combined_df$prop_pav_D
combined_df$calculated_total_PAV <- combined_df$calculated_D_PAV + combined_df$calculated_O_PAV +
combined_df$calculated_M_PAV
View(combined_df)
combined_df <- combined_df %>% select(Playing.for, First.name, Surname, calculated_total_PAV,
calculated_O_PAV, calculated_M_PAV, calculated_D_PAV)
View(combined_df)
library('fitzRoy')
library('dplyr')
library('sys')
#make Pavs for given year
#today <- Sys.Date()
afltables<-fetch_player_stats_afltables(2023)
afltables_home<-filter(afltables, Playing.for==Home.team)
afltables_away<-filter(afltables,Playing.for==Away.team)
afltables_home$pavO<-afltables_home$Home.score +
0.25*afltables_home$Hit.Outs +
3*afltables_home$Goal.Assists+
afltables_home$Inside.50s+
afltables_home$Marks.Inside.50+
(afltables_home$Frees.For-afltables_home$Frees.Against)
afltables_home$pavD<-20*afltables_home$Rebounds +
12*afltables_home$One.Percenters+
(afltables_home$Marks-4*afltables_home$Marks.Inside.50+2*(afltables_home$Frees.For-afltables_home$Frees.Against))-
2/3*afltables_home$Hit.Outs
afltables_home$pavM<-15*afltables_home$Inside.50s+
20*afltables_home$Clearances +
3*afltables_home$Tackles+
1.5*afltables_home$Hit.Outs +
(afltables_home$Frees.For-afltables_home$Frees.Against)
afltables_away$pavO<-afltables_away$Away.score +
0.25*afltables_away$Hit.Outs +
3*afltables_away$Goal.Assists+
afltables_away$Inside.50s+
afltables_away$Marks.Inside.50+
(afltables_away$Frees.For-afltables_away$Frees.Against)
afltables_away$pavD<-20*afltables_away$Rebounds +
12*afltables_away$One.Percenters+
(afltables_away$Marks-4*afltables_away$Marks.Inside.50+2*(afltables_away$Frees.For-afltables_away$Frees.Against))-
2/3*afltables_away$Hit.Outs
afltables_away$pavM<-15*afltables_away$Inside.50s+
20*afltables_away$Clearances +
3*afltables_away$Tackles+
1.5*afltables_away$Hit.Outs +
(afltables_away$Frees.For-afltables_away$Frees.Against)
fulltable<-rbind(afltables_home,afltables_away)
names(fulltable)
players <- fulltable%>%group_by(Playing.for, First.name, Surname, ID)%>%
summarise(total_O_pav=sum(pavO), total_D_pav=sum(pavD), total_M_pav=sum(pavM), games_played=n())
teams <- fulltable%>%group_by(Playing.for)%>%
summarise(team_O_pav=sum(pavO), team_D_pav=sum(pavD), team_M_pav=sum(pavM))
sum_O <- sum(teams$team_O_pav)
sum_M <- sum(teams$team_M_pav)
sum_D <- sum(teams$team_D_pav)
teams$prop_pav_O <- (teams$team_O_pav / sum_O) * 1800
teams$prop_pav_M <- (teams$team_M_pav / sum_M) * 1800
teams$prop_pav_D <- (teams$team_D_pav / sum_D) * 1800
team_played <- fulltable%>%group_by(Playing.for, Round) %>% select(Playing.for, Round) %>% distinct() %>%
group_by(Playing.for) %>% summarise(team_played_games = n())
teams <- merge(teams, team_played)
combined_df <- left_join(players, teams, by = 'Playing.for')
combined_df$calculated_O_PAV <- (combined_df$total_O_pav / combined_df$team_O_pav) * combined_df$prop_pav_O
combined_df$calculated_M_PAV <- (combined_df$total_M_pav / combined_df$team_M_pav) * combined_df$prop_pav_M
combined_df$calculated_D_PAV <- (combined_df$total_D_pav / combined_df$team_D_pav) * combined_df$prop_pav_D
combined_df$calculated_total_PAV <- combined_df$calculated_D_PAV + combined_df$calculated_O_PAV +
combined_df$calculated_M_PAV
combined_df <- combined_df %>% select(Playing.for, First.name, Surname, calculated_total_PAV,
calculated_O_PAV, calculated_M_PAV, calculated_D_PAV)
View(combined_df)
rename(combined_df$firstname = combined_df$First.name, combined_df$surname = combined_df$Surname)
combined_df <- combined_df %>% rename(firstname = First.name, surname = Surname)
View(combined_df)
combined_df <- combined_df %>% select(Playing.for, First.name, Surname, calculated_total_PAV)
combined_df <- left_join(players, teams, by = 'Playing.for')
combined_df$calculated_O_PAV <- (combined_df$total_O_pav / combined_df$team_O_pav) * combined_df$prop_pav_O
combined_df$calculated_M_PAV <- (combined_df$total_M_pav / combined_df$team_M_pav) * combined_df$prop_pav_M
combined_df$calculated_D_PAV <- (combined_df$total_D_pav / combined_df$team_D_pav) * combined_df$prop_pav_D
combined_df$calculated_total_PAV <- combined_df$calculated_D_PAV + combined_df$calculated_O_PAV +
combined_df$calculated_M_PAV
combined_df <- combined_df %>% select(Playing.for, First.name, Surname, calculated_total_PAV)
combined_df <- combined_df %>% rename(firstname = First.name, surname = Surname)
View(combined_df)
write.csv(combined_df, "R_Code/generated_pavs.csv", row.names=FALSE)
getwd()
setwd("~/Documents/Mitch/AFL_Data/AFL_Data/AFL_ML/R_Code/")
setwd("~/Documents/Mitch/AFL_Data/AFL_Data/AFL_ML/")
write.csv(combined_df, "R_Code/generated_pavs.csv", row.names=FALSE)
